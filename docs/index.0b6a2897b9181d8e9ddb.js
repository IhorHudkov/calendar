(()=>{"use strict";class e{constructor(e){this._name=e,this._role="user"}get name(){return this._name}get role(){return this._role}}class t extends e{constructor(e){super(e),this._role="admin"}}const n=["Jhon","Mila","Sam","Molly","Garry","Lisa","Mike"],r=[];for(let a=0;a<n.length;a+=1)a<3?r.push(new t(n[a])):r.push(new e(n[a]));const a=r,o=My$.modal({content:`\n    <p>Please, authorise</p>\n    <p id="role"></p>\n    <select class="form-select form-select-lg mb-3" id="auth-select">\n        <option selected>Select a name</option>\n        ${(()=>{let e="";for(const t of a)e+=`<option value="${t.name}">${t.name}</option>\n\t`;return e})()}\n    </select>\n    <div class="modal-buttons">\n        <button type="button" class="btn btn-primary" id="confirm">Confirm</button>\n    </div>\n  `});class s{constructor(){if(s.exists)return s.instance;s.instance=this,s.exists=!0,this.url="http://158.101.166.74:8080/api/data/ihor_hudkov/"}async getAll(e){const t=await fetch(`${this.url}${e}`);return await t.json()}async create(e,t){const n=await this.getAll(e);if(n){if("events"===e)for(const e of n)if(JSON.parse(e.data).dayTime===t.dayTime)throw new Error("Failed to create an event. Time slot is already booked.");if("users"===e)for(const e of n)if(JSON.parse(e.data).name===t.name)throw new Error("Failed to create a user. The user with the same name already exists.")}const r={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:`{"data": "${JSON.stringify(t).replace(/"/g,'\\"')}"}`},a=await fetch(`${this.url}${e}`,r);return await a.json()}async delete(e,t){return(await fetch(`${this.url}${e}/${t}`,{method:"DELETE"})).ok}async update(e,t,n){return(await fetch(`${this.url}${e}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:`{"data": "${JSON.stringify(n).replace(/"/g,'\\"')}"}`})).ok}}const c=new s;const i=document.getElementById("checkBoxes"),l=document.querySelectorAll("td"),d=My$.modal({content:'\n    <p>Are You sure You want to delete "Retrospective" event?</p>\n    <div class="modal-buttons">\n      <button type="button" class="btn btn-danger" id="yes">Yes</button>\n      <button type="button" class="btn btn-outline-dark" id="no">No!</button>\n    </div>\n  '});window.addEventListener("load",(()=>{function e(e){const{currentTarget:t}=e,{target:n}=e;d.open();const r=document.querySelector("#yes"),a=document.querySelector("#no"),o=()=>{d.close(),r.removeEventListener("click",s),a.removeEventListener("click",o)},s=()=>{const e=t.parentNode.getAttribute("id");c.delete("events",e).then((t=>{t?(n.parentNode.remove(),d.close(),console.log(e),alert("Event successfully deleted!")):(d.close(),alert("Something went wrong!")),r.removeEventListener("click",s),a.removeEventListener("click",o)}),(e=>{d.close(),alert(e.message),r.removeEventListener("click",s),a.removeEventListener("click",o)}))};r.addEventListener("click",s),a.addEventListener("click",o)}function t(t){const n=[];document.querySelectorAll('input[type="checkbox"]:checked').forEach((e=>{const t=document.querySelector(`label[for="${e.id}"`);n.push(t.textContent.trim())})),c.getAll("events").then((r=>{r&&r.forEach((r=>{const{participants:a}=r;if("all"===t||My$.arrCompare(a,n)){const t=`td[headers="${JSON.parse(r.data).dayTime}"]`,n=document.querySelector(t),a=document.createElement("div"),o=document.createElement("span"),s=document.createElement("span");a.setAttribute("id",r.id),a.setAttribute("draggable","true"),s.innerHTML="&times;",o.textContent=JSON.parse(r.data).name,n.appendChild(a),a.appendChild(o),a.appendChild(s),a.classList.add("td-content"),s.classList.add("td__delete-btn"),s.addEventListener("click",e)}}))}))}function n(e){e.preventDefault()}function r(e){e.dataTransfer.setData("headers",e.currentTarget.getAttribute("headers"))}function s(e){const t=e.dataTransfer.getData("headers");e.target.appendChild(document.querySelector(`td[headers="${t}"]`).firstChild),class{static async getEventByDayTime(e){return c.getAll("events").then((t=>{let n;for(const r of t)if(JSON.parse(r.data).dayTime===e){n=r;break}return n}))}}.getEventByDayTime(t).then((t=>{const n=e.target.getAttribute("headers");return{desiredEvent:t,newData:{name:JSON.parse(t.data).name,participants:JSON.parse(t.data).participants,dayTime:n}}})).then((e=>{c.update("events",e.desiredEvent.id,e.newData).then((e=>{e?alert("Successfully updated!"):alert("Something went wrong :(")}),(t=>{console.log(e.desiredEvent.id),console.log(e.newData),alert(`${t.message}`)}))}))}t("all"),i.addEventListener("closebox",(()=>{l.forEach((e=>{e.firstChild&&e.firstChild.remove()})),t()}),!1),l.forEach((e=>{e.addEventListener("dragover",n),e.addEventListener("dragstart",r),e.addEventListener("drop",s)})),o.open();const u=document.querySelector("#auth-select"),m=()=>{const e=document.querySelector("#auth-select>option:checked").value;let t;return"Select a name"!==e&&(t=a.find((t=>t.name===e&&t))),t};u.onchange=()=>{document.getElementById("role").innerText=`Role: ${m()?m().role:""}`};document.querySelector("#confirm").onclick=()=>{let e;if(m()&&(e=m().role,o.close()),"user"===e){document.querySelector("#new-event-btn").style.display="none",document.querySelector(".select-names").style.marginRight=0,l.forEach((e=>{e.removeEventListener("dragover",n),e.removeEventListener("dragstart",r),e.removeEventListener("drop",s)}));const e=document.querySelectorAll(".td__delete-btn");console.log(e);for(const t of e)t.style.display="none"}}}))})();